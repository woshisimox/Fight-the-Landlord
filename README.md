# Dou Dizhu AI Arena (3 Players: 甲 / 乙 / 丙)

参考你提供的《rule.docx》，实现了 3 人斗地主的对战/比赛引擎与简单 AI 选手。默认采用 **叫分制**（A 方案），也支持可选的 **叫/抢地主制**（B 方案）。

- 地主 1 人 vs 农民 2 人，总 54 张牌（含大小王），发牌 17×3 + 3 张底牌。
- 牌型、出牌、比较与计分规则严格按 `rules/rules.txt`（从 `rule.docx` 提取）实现：
  - 单张、对子、三张、三带一、三带二、顺子（≥5）、连对（≥3 对）、飞机（≥2 个三连）、飞机带翅膀（带单或带对）、四带二（代码默认两种都支持：带两单 / 带两对，可按需限制）、炸弹、王炸等；
  - 同型对比按 **主干牌**（如三张/连三的最小点）比较，带牌不比较大小；
  - 顺子/连对/飞机按 **最小牌** 比较，`2/王` 不参与顺子/连对/飞机；
  - 炸弹、王炸可压制一切；炸弹之间按点数比较，王炸最大；
  - 计分：基础分=叫分（1/2/3）。每出现 **炸弹/王炸×2**；**春天/反春×2**；若开启“抢地主倍数”，每“抢”×2。

> 详细规则文本见 `rules/rules.txt`（由 `rule.docx` 自动提取）。若需要我们适配你们的地方规则（如“**四带二**带两对版”、“**飞机带翅**允许含 2/王”、“**明牌倍率**”等），请在 `src/game/rules.ts` 中切换/修改对应开关。

## 快速开始

1. 安装依赖（需要 Node.js 18+）：
   ```bash
   npm i
   ```
2. 运行 10 局测试：
   ```bash
   npm run play
   ```
   或自定义：
   ```bash
   npx ts-node src/cli.ts --rounds 100 --seed 123 --rob=false --four2=2singles
   ```

常用参数：
- `--rounds <N>`：对战局数（默认 10）。
- `--seed <INT>`：伪随机种子，便于复现。
- `--rob <true|false>`：是否启用“叫/抢地主制”（默认 `false`=叫分制）。
- `--four2 <2singles|2pairs|both>`：四带二的规则（默认 `both`，两种都允许）。
- `--log <dir>`：日志目录（默认 `./logs`）。

## 目录结构
```
doudizhu-ai-arena/
  rules/
    rule.docx       # 你提供的规则文件
    rules.txt       # 自动提取的纯文本（供代码读取）
  src/
    game/           # 牌面、牌型识别、出牌引擎、记分等
    bots/           # 三个示例 AI：甲/乙/丙
    match/          # 轮换地主、统计积分、导出日志 CSV
    cli.ts          # 命令行入口
  package.json
  tsconfig.json
```

## 选手（示例）
- `甲(A)`: **GreedyMin**（跟牌尽量用最小可赢牌；首出优先顺子/连对/飞机以“跑牌”）
- `乙(B)`: **GreedyMax**（能赢就用较强牌型保持控制；有炸弹倾向保留）
- `丙(C)`: **RandomLegal**（完全随机的合法出牌）

> 你可以在 `src/bots/` 中添加自己的智能体，只要实现 `IBot` 接口即可。

## 比赛与日志
- 每局都会把发牌、叫分/抢地主、每轮出牌、炸弹/王炸/春天等事件、最终结算写入 JSON。
- `match/arena.ts` 会总结生成 `summary.csv`（包含每个座位作为地主/农民的胜场、炸弹数、平均倍数等）。

## 与“麻将 AI 比赛”的对齐
本工程是 **命令行/库** 形态，便于先验证规则与 AI 接口。若你希望 **Web UI**（Next.js）复用麻将项目的页面框架，我可以在下一版把这套引擎包装成前端可视化（回放、对局列表、日志过滤、AI 接口选择等）。

---

若任何细节与 `rule.docx` 有出入，请把差异标注给我，我会同步修正并回传一个“清爽版”代码包。
